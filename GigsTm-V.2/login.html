<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login - GigsTm</title>
    <link rel="stylesheet" href="login-themed.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>
  <body>
    <div class="site-wrapper">
      <header class="site-header">
        <div class="brand-logo">
          <a href="index.html">
            <img
              src="./GigsTm_files/lgo_project1.png"
              alt="GigsTm"
              class="light-version-logo default-logo"
            />
          </a>
        </div>
        <div class="header-btns">
          <a class="btn btn-transparent" href="index.html"> Back to Home </a>
        </div>
      </header>

      <main>
        <div class="auth-container">
          <h4 style="text-align: center">
            Welcome back! Letâ€™s get you signed in.
          </h4>
          <div class="auth-tabs">
            <div class="auth-tab active" onclick="showTab('login', event)">
              Login
            </div>
            <div class="auth-tab" onclick="showTab('signup', event)">
              Sign Up
            </div>
          </div>

          <!-- Login Form -->
          <div id="login-form" class="auth-form">
            <div id="login-message" class="auth-message"></div>
            <div class="form-group">
              <label for="login-email">Email</label>
              <input
                type="email"
                id="login-email"
                placeholder="Enter your email"
              />
            </div>
            <div class="form-group">
              <label for="login-password">Password</label>
              <input
                type="password"
                id="login-password"
                placeholder="Enter your password"
              />
            </div>
            <button type="button" id="login-btn" onclick="handleLogin()">
              Login
            </button>
            <p style="text-align: center; margin-top: 1rem">
              <a
                href="#"
                id="forgot-password-link"
                onclick="showPasswordReset(event)"
                >Forgot password?</a
              >
            </p>

            <!-- Forgot Password Modal -->
            <div
              id="forgot-password-modal"
              style="
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.5);
                z-index: 1000;
                justify-content: center;
                align-items: center;
              "
            >
              <div
                style="
                  background: white;
                  padding: 2rem;
                  border-radius: 8px;
                  width: 90%;
                  max-width: 400px;
                "
              >
                <h3 style="margin-top: 0">Reset Password</h3>
                <p>
                  Enter your email address and we'll send you a link to reset
                  your password.
                </p>
                <div
                  id="reset-message"
                  class="auth-message"
                  style="margin: 1rem 0"
                ></div>
                <div class="form-group">
                  <label for="reset-email">Email Address</label>
                  <input
                    type="email"
                    id="reset-email"
                    placeholder="Enter your email"
                    style="width: 100%"
                  />
                </div>
                <div
                  style="
                    display: flex;
                    justify-content: flex-end;
                    gap: 1rem;
                    margin-top: 1.5rem;
                  "
                >
                  <button
                    type="button"
                    onclick="document.getElementById('forgot-password-modal').style.display = 'none'"
                    style="
                      background: #e5e7eb;
                      color: #4b5563;
                      border: none;
                      padding: 0.5rem 1rem;
                      border-radius: 4px;
                      cursor: pointer;
                    "
                  >
                    Cancel
                  </button>
                  <button
                    type="button"
                    onclick="handlePasswordReset()"
                    style="
                      background: #026bae;
                      color: white;
                      border: none;
                      padding: 0.5rem 1rem;
                      border-radius: 4px;
                      cursor: pointer;
                    "
                  >
                    Send Reset Link
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Sign Up Form -->
          <div id="signup-form" class="auth-form" style="display: none">
            <div id="signup-message" class="auth-message"></div>
            <div class="form-group">
              <label for="signup-email"
                >Email <span class="required">*</span></label
              >
              <input
                type="email"
                id="signup-email"
                placeholder="Enter your email"
                required
              />
            </div>
            <div class="form-group">
              <label for="signup-password"
                >Password <span class="required">*</span></label
              >
              <input
                type="password"
                id="signup-password"
                placeholder="Create a password"
              />
            </div>
            <div class="form-group">
              <label for="confirm-password"
                >Confirm Password <span class="required">*</span></label
              >
              <input
                type="password"
                id="confirm-password"
                placeholder="Confirm your password"
              />
            </div>
            <button type="button" id="signup-btn" onclick="handleSignUp()">
              Create Account
            </button>
          </div>
        </div>
      </main>

      <footer class="footer">
        <p>&copy; 2025 GigsTm. All rights reserved.</p>
      </footer>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-auth.js"></script>
    <script>
      // --- Firebase Configuration ---
      const firebaseConfig = {
        apiKey: "AIzaSyDSzL3kP_1jKuYzn4YgZNKsKizsl7fUXjE",
        authDomain: "gigstm-12345.firebaseapp.com",
        projectId: "gigstm-12345",
        storageBucket: "gigstm-12345.appspot.com",
        messagingSenderId: "123456789012",
        appId: "1:123456789012:web:abc123def456",
      };

      // Initialize Firebase
      if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
      } else {
        firebase.app(); // if already initialized, use that one
      }

      // --- Configuration ---
      const API_BASE_URL = "/api"; // Using a relative path to the backend API

      // --- UI Helper Functions ---
      function showMessage(elementId, message, type) {
        const element = document.getElementById(elementId);
        if (!element) return;
        element.textContent = message;
        element.className = `auth-message ${type}`;
        element.style.display = "block";
        setTimeout(() => {
          element.style.display = "none";
        }, 5000);
      }

      function showTab(tabName, event) {
        document.getElementById("login-form").style.display =
          tabName === "login" ? "block" : "none";
        document.getElementById("signup-form").style.display =
          tabName === "signup" ? "block" : "none";

        document
          .querySelectorAll(".auth-tab")
          .forEach((tab) => tab.classList.remove("active"));
        event.currentTarget.classList.add("active");
      }

      // --- API Call Functions ---
      function showPasswordReset(event) {
        event.preventDefault();
        document.getElementById("forgot-password-modal").style.display = "flex";
      }

      async function handlePasswordReset() {
        const email = document.getElementById("reset-email").value.trim();
        if (!email) {
          showMessage(
            "reset-message",
            "Please enter your email address.",
            "error"
          );
          return;
        }

        try {
          await firebase.auth().sendPasswordResetEmail(email);
          showMessage(
            "reset-message",
            "Password reset email sent. Please check your Inbox or Spam folder.",
            "success"
          );
        } catch (error) {
          showMessage("reset-message", error.message, "error");
        }
      }

      async function handleLogin() {
        const email = document.getElementById("login-email").value.trim();
        const password = document.getElementById("login-password").value;
        const loginBtn = document.getElementById("login-btn");

        if (!email || !password) {
          showMessage(
            "login-message",
            "Please enter both email and password.",
            "error"
          );
          return;
        }

        loginBtn.disabled = true;
        loginBtn.textContent = "Logging in...";

        try {
          const response = await fetch(`${API_BASE_URL}/auth/signin`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, password }),
          });

          const result = await response.json();

          if (!response.ok) {
            throw new Error(result.error || "Login failed.");
          }

          showMessage(
            "login-message",
            "Login successful! Redirecting...",
            "success"
          );
          setTimeout(() => {
            window.location.href = "userform.html"; // Redirect to userform on success
          }, 1000);
        } catch (error) {
          showMessage("login-message", error.message, "error");
        } finally {
          loginBtn.disabled = false;
          loginBtn.textContent = "Login";
        }
      }

      async function handleSignUp() {
        const email = document.getElementById("signup-email").value.trim();
        const password = document.getElementById("signup-password").value;
        const confirmPassword =
          document.getElementById("confirm-password").value;
        const signupBtn = document.getElementById("signup-btn");

        if (!email || !password || !confirmPassword) {
          showMessage(
            "signup-message",
            "Please fill in all required fields.",
            "error"
          );
          return;
        }

        if (password !== confirmPassword) {
          showMessage("signup-message", "Passwords do not match.", "error");
          return;
        }

        if (password.length < 6) {
          showMessage(
            "signup-message",
            "Password must be at least 6 characters long.",
            "error"
          );
          return;
        }

        signupBtn.disabled = true;
        signupBtn.textContent = "Creating Account...";

        try {
          const response = await fetch(`${API_BASE_URL}/auth/signup`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, password }),
          });

          const result = await response.json();

          if (!response.ok) {
            throw new Error(result.error || "Sign-up failed.");
          }

          showMessage(
            "signup-message",
            result.message ||
              "Account created! Please check your email to confirm.",
            "success"
          );

          setTimeout(() => {
            window.location.href = "login.html";
          }, 2000);
        } catch (error) {
          showMessage("signup-message", error.message, "error");
        } finally {
          signupBtn.disabled = false;
          signupBtn.textContent = "Create Account";
        }
      }
    </script>
  </body>
</html>
